# recharts介绍 {#intro}


recharts
========
[![Build Status](https://travis-ci.org/taiyun/recharts.png)](https://travis-ci.org/taiyun/recharts)

A R interface to [ECharts](https://github.com/ecomfe/echarts) for data visualization.

recharts 提供了百度开源可视化js框架ECharts的R语言接口，现提供的图形展示接口包括：地图（eMap），柱状图（eBar），折线图（eLine），
雷达图（eRadar），散点图（ePoints），漏斗图（eFunnel）以及万恶的饼图（ePie）。
同时计划对力导向图（[eForce](http://echarts.baidu.com/demo.html#graph-force)），
时间序列散点图([ePoints_timeSeries](http://echarts.baidu.com/demo.html#graph-life-expectancy))，
矩阵树图([eTree](http://echarts.baidu.com/demo.html#treemap-disk))，
平行坐标图([eParallel](http://echarts.baidu.com/demo.html#parallel-aqi))
和桑基图（[eSankey](http://echarts.baidu.com/demo.html#sankey-energy)）图逐一实现。

# recharts的安装(Installation)
recharts包的源代码在[Github/taiyun/recharts](https://github.com/taiyun/recharts)上提供下载与安装，安装需要使用以下代码：

```{r eval = F}
require(devtools)
devtools::install_github("taiyun/recharts@dev")
```


目前计划任务列表在[https://github.com/taiyun/recharts/issues/43](https://github.com/taiyun/recharts/issues/43)

欢迎贡献issue以及贡献代码



<!--chapter:end:01-rechartsIntro.Rmd-->

# 案例及接口 {#interface}

## 官网案例(echartsExample)

`echartsExample`提供了一种从官网的[官方实例](http://echarts.baidu.com/examples.html)中获取JS代码并运行的途径, 除去某些需要加载JSON数据文件的例子, echartsExample`支持大部分Echarts的官网案例.

这个函数支持的范围比较广, 包括Echarts的基本绘图, ecstat, bamap等高级功能, 是JS代码的源生接口

![EChartsExamples](pic/EChartsExamples.png)


参数: 

- `url` 例子的网址, 比如`'http://echarts.baidu.com/demo.html#bubble-gradient'`
- `JScontent` 需要执行的JS代码(方便复制例子里面的代码调试执行), **注意要命名一个`option`对象用于数据加载**
- `height` 绘图区域的高度
- `weight` 绘图区域的宽度, 支持百分比


### 官网案例

从http://echarts.baidu.com/demo.html#effectScatter-bmap 获取代码, 并转换为R绘图.

```{r}
library(recharts)
echartsExample("http://echarts.baidu.com/demo.html#effectScatter-bmap")
```


### JS代码案例 {#jscode}

在R的环境中基于源生JS代码执行echarts绘图.

```{r}
JScodes = "
var option = {
  title: {
    text: 'ECharts entry example'
  },
  tooltip: {},
  legend: {
    data:['Sales']
  },
  xAxis: {
    data: ['shirt','cardign','chiffon shirt','pants','heels','socks']
  },
  yAxis: {},
  series: [{
    name: 'Sales',
    type: 'bar',
    data: [5, 20, 36, 10, 10, 20]
  }]
};
"
echartsExample(JScontent=JScodes)
```


## 从R对象中绘图(ePlot)

R中实现Echarts的形式类似于在R中建立一个List来模拟上例中option对象, 然后通过写好的框架实现Echarts对象的绘制, 其中`ePlot`, 用于根据一个R的list对象来构建Echarts.
其实, 更粗暴的方式是从`htmlwidgets::createWidget('echarts', opt, package = 'recharts')`来构建.

参数: 

- `series` 用于保存echarts中的数据内容, 类似echarts中的`option.series`
- `ext` 用于保存echarts中的其他设置参数, 类似echarts中的`option.xAsix`等
- `size` 绘图区域的宽度与高度

### 构建基本对象

我们可以用这个方法构建之前[JS实现的例子](#jscode)
```{r}
# 定义数据部分
series = list(list(
   name = 'Sales',
   type = 'bar',
   data = c(5, 20, 36, 10, 10, 20)
))
# 定义坐标轴部分
ext = list(
  xAxis = list(list( 
    data = c('shirt','cardign','chiffon shirt','pants','heels','socks')
  )),
  yAxis = list(list())
)
# 绘制
ePlot(series, ext)
```

当然, 这个例子可以更粗暴的用`htmlwidgets::createWidget`实现, 其实你所看到的recharts的例子, 底层都是通过调用这个函数实现的:

```{r eval = F}
opt = list(
  xAxis = list(list( 
    data = c('shirt','cardign','chiffon shirt','pants','heels','socks')
  )),
  
  yAxis = list(list()),
  series = list(list(
   name = 'Sales',
   type = 'bar',
   data = c(5, 20, 36, 10, 10, 20)
))
)
htmlwidgets::createWidget('echarts', opt, package = 'recharts')
```

### 线柱混合
这是一个用ePlot来实现线柱混合的例子, 原始数据设定来源于[Echarts](http://echarts.baidu.com/demo.html#multiple-y-axis)

```{r}
series2 = list(
  list(
    name = '蒸发量',
    type = 'bar',
    data = c(2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3)
  ),
  list(
    name = '降水量',
    type = 'bar',
    data = c(2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 175.6, 182.2, 48.7, 18.8, 6.0, 2.3)

  ),
  list(
    name = '平均温度',
    type = 'line',
    yAxisIndex = 1,
    data = c(2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2)

  )
)

ext = list(
  xAxis = list(list(
    type = "category",
    data = c("1月", "2月", "3月", "4月", "5月", "6月",
             "7月", "8月", "9月", "10月", "11月",  "12月")
)),
  yAxis = list(
    list(
      type =  'value',
      name =  '水量',
      min =  0,
      max =  250,
      interval =  50,
      axisLabel =  list(
        formatter =  '{value} ml'
      )
    ),
   list(
      type =  'value',
      name =  '温度',
      min =  0,
      max =  25,
      interval =  5,
      axisLabel = list(
        formatter= '{value}℃'
      )
    )
  ))
ePlot(series2, ext )
```


<!--chapter:end:02-example.Rmd-->

# 基本绘图函数 {#baseFunction}

## 散点图

散点图需要的输入是data.frame，需要指定`xvar`和`yvar`， `series`为可选的颜色分度参数，

```{r echo = FALSE}
library(recharts)
```


```{r}
ePoints(iris[, 3:5], theme = 2)
iris$Species <- as.character(iris$Species)
iris[1:20, "Species"] = "redFlower"
ePoints(iris[,3:5], xvar = ~Petal.Length, yvar = ~Petal.Width, series = ~Species, theme = 1)
ePoints(iris[,3:5], xvar = ~Petal.Length, yvar = ~Petal.Width, series = ~Species, theme = 6)
```




## 线图

```{r results='hold'}
head(WorldPhones)
eLine(WorldPhones, theme=1)
```
```{r warning=FALSE}
#mode 2 input.
df2 <- data.frame(
  saleNum=c(10,20,30,40,50,60,70,15,25,35,45,55,65,75,25,35,45,55,65,75,85),
  seller=c(rep("Yellow",7), rep("Red",7), rep("White",7)),
	 weekDay = c(rep(c("Mon","Tue","Wed","Thu","Fri","Sat","Sun"),3)),
  stringsAsFactors =FALSE
)
eLine(df2, xvar=~weekDay, yvar= ~saleNum, series=~seller)

dat <- cut(rnorm(1000), -4:4)
eLine(dat)
```


## 条形图
```{r}
require(plyr)
dat = ddply(iris, .(Species), colwise(mean))  
rownames(dat) = dat[,1]
dat = dat[, -1]
dat
eBar(dat)
eBar(dat, horiz = TRUE)
#mode 2 input.
df2 <- data.frame(
 saleNum=c(10,20,30,40,50,60,70,15,25,35,45,55,65,75,25,35,45,55,65,75,85),
 seller=c(rep("Yellow",7), rep("Red",7), rep("White",7)),
 weekDay = c(rep(c("Mon","Tue","Wed","Thu","Fri","Sat","Sun"),3)),
 stringsAsFactors =FALSE
)
dat <- df2
xvar=~weekDay; yvar= ~saleNum; series=~seller
eBar(df2, xvar = ~seller, ~saleNum, ~weekDay )
eBar(df2, xvar = ~seller, ~saleNum, ~weekDay, stack=T)
eBar(df2, xvar = ~seller, ~saleNum, ~weekDay, stackGroup = list(c('Sat','Sun')))
dat <- df2[1:7,]
eBar(dat, ~weekDay, ~saleNum)
dat <- cut(rnorm(1000), -4:4)
eBar(dat)

```

## 饼图
```{r}
x = runif(6)
names(x) = LETTERS[1:6]
ePie(x) + eTitle("test")
testData <- head(mapTestData_chs, 5)
ePie(testData, ~stdName, ~val1)
```


<!--chapter:end:03-basicFunction.Rmd-->

# 高级绘图函数 {#nbFunction}

```{r echo = FALSE}
library(recharts)
```

## 堆砌区域图
```{r}
require(plyr)
eArea(WorldPhones, theme=1)
#mode 2 input.
df2 <- data.frame(
  saleNum=c(10,20,30,40,50,60,70,15,25,35,45,55,65,75,25,35,45,55,65,75,85),
  seller=c(rep("Yellow",7), rep("Red",7), rep("White",7)),
	 weekDay = c(rep(c("Mon","Tue","Wed","Thu","Fri","Sat","Sun"),3)),
  stringsAsFactors =FALSE
)
eArea(df2, xvar=~weekDay, yvar= ~saleNum, series=~seller)

dat <- cut(rnorm(1000), -4:4)
eArea(dat)
```

## K线图

```{r}
mat = rbind(c(2286.33,2299.99,2281.9,2309.39),
            c(2297.11,2305.11,2290.12,2305.3),
            c(2303.75,2302.4,2292.43,2314.18),
            c(2293.81,2275.67,2274.1,2304.95),
            c(2281.45,2288.53,2270.25,2292.59),
            c(2286.66,2293.08,2283.94,2301.7),
            c(2293.4,2321.32,2281.47,2322.1),
            c(2323.54,2324.02,2321.17,2334.33),
            c(2316.25,2317.75,2310.49,2325.72),
            c(2320.74,2300.59,2299.37,2325.53),
            c(2300.21,2299.25,2294.11,2313.43),
            c(2297.1,2272.42,2264.76,2297.1),
            c(2270.71,2270.93,2260.87,2276.86),
            c(2264.43,2242.11,2240.07,2266.69),
            c(2242.26,2210.9,2205.07,2250.63),
            c(2190.1,2148.35,2126.22,2190.1)
)
rownames(mat) = Sys.Date()-(16:1)
eCandle(mat)
eCandle(mat, theme = 1)
```

## 漏斗图

```{r}
x = c("Exposure" = 100, "Click" = 80, "Visit" = 60, "Query"=40, "Buy"=20)
eFunnel(x) +eTitle(title = "Funnel Plot")
funnelDf <- data.frame(namevar = c("Exposure", "Click", "Visit", "Query", "Buy"),
   datavar = c(100, 80, 60, 40, 20), stringsAsFactors=FALSE)
eFunnel(funnelDf, ~namevar, ~datavar, theme =1)
```

## 平行坐标
```{r}
require(plyr)

axisList = list(
	list(index=7, type="category", data = c("low", "middle", "high")),
	list(index=6, inverse=TRUE, max=50, nameLocation="start")
)
eParallel(head(parallelDf, 20), series=~groupName, axisList = axisList)
```

## 雷达图
```{r}
require(plyr)
dat = ddply(iris, .(Species), colwise(mean))
rownames(dat) = dat[,1]
dat = dat[, -1]
dat
eRadar(dat)
df2 <- data.frame(
 saleNum=c(10,20,30,40,50,60,70,15,25,35,45,55,65,75,25,35,45,55,65,75,85),
	seller=c(rep("Yellow",7), rep("Red",7), rep("White",7)),
weekDay = c(rep(c("Mon","Tue","Wed","Thu","Fri","Sat","Sun"),3))
)
dat <- df2
xvar=~weekDay; yvar= ~saleNum; series=~seller
eRadar(df2, ~weekDay, ~saleNum, ~seller)
dat = data.frame(IE8 = (40 - 1:28) * 10,
                 IE9 = (38 - 1:28) * 4 + 60,
                 Safari = 1:28 * 5 + 10,
                 Firefox = 1:28 * 9,
                 Chrome = 1:28 * 1:28 /2)
row.names(dat) = 2001:2028
chart = eRadar(dat, ymax = rep(400,5))
chart$x$visualMap=list(color=c('red','yellow'))
chart
```

## 水球图
```{r}
eLiquid(0.6)
eLiquid(0.6,wave = 6)
```

## 桑基图
```{r}
dat = data.frame(source=c("Agricultural 'waste'","Bio-conversion",
                          "Bio-conversion","Bio-conversion","Bio-conversion",
                          "Biofuel imports","Biomass imports","Coal imports",
                          "Coal reserves","Coal","District heating","District heating",
                          "District heating","Electricity grid","Electricity grid"),
                 target=c("Bio-conversion","Liquid","Losses","Solid","Gas","Liquid",
                          "Solid","Coal","Coal","Solid","Industry","Heating and cooling - commercial",
                          "Heating and cooling - homes","Over generation / exports","Heating and cooling - homes"),
                 value=c(124.729,0.597,26.862,280.322,81.144,35,35,11.606,63.965,75.571,
                         10.639,22.505,46.184,104.453,113.726))
eSankey(dat)
```


## 词云
```{r}
eWordcloud(wordFreqDf_chs, namevar = ~Word, datavar = ~Freq)
```

## 地图
```{r}
mapData <- head(mapTestData_chs, 5)
eMap(mapData, namevar=~stdName, datavar = ~val1 + val2)
provinceMapData <- mapTestData_chs[6:15,]
eMap(provinceMapData, namevar=~stdName, datavar = ~val1+val2, region=unique(provinceMapData$motherName)[1])
```

<!--chapter:end:04-nbFnuction.Rmd-->

# 补充函数 {#supportFunction}


```{r echo = FALSE}
library(recharts)
```


## MarkPoint

```{r}
dat <- cut(rnorm(1000), -4:4)
chart = eLine(dat)
eMarkPoint(chart, type=c('max','min'),valueIndex = 1)
eMarkPoint(chart, dat = data.frame(2:3,rep(200,2)),
         type=c('max','min'),valueIndex = 1)
```


## HLine
```{r}
chart = ePoints(iris[, 3:5], theme = 2)
eHLine(chart,1,lineColor = 'blue')
eHLine(chart,'min',lineWidth = 5)
```

## VLine
```{r}
eVLine(chart,1,lineColor = 'blue')
eVLine(chart,'min',lineWidth = 5)
```


## MarkLine

```{r}
eMarkLine(chart, c(1,0), c(7,2.5))
```


<!--chapter:end:05-supportFunction.Rmd-->

# Introduction {#help}

You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(function).

Figures and tables with captions will be placed in `figure` and `table` environments, respectively.

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(iris, 20), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

You can write citations, too. For example, we are using the **bookdown** package [@R-bookdown] in this sample book, which was built on top of R Markdown and **knitr** [@xie2015].

<!--chapter:end:06-bookdownHelp.Rmd-->

